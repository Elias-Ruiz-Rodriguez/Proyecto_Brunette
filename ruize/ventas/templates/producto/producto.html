<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock de Productos</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'producto/producto.css' %}">
</head>
<body>
    <div class="container">
        <div class="header">
            <p>Cajero: {{ usuario_nombre }}</p>
            <div class="time-date">
                <span class="time">09:15:36</span>
                <span class="date">27/09/2024</span>
            </div>
        </div>
        
        <div class="pedido-section">
            <h2>PRODUCTOS</h2>
            <div class="product-input-section">
                <form method="get" action="{% url 'producto' %}">
                    <label for="product">PRODUCTO:</label>
                    <input type="text" id="product" name="product" placeholder="Buscar producto...">
                    <button type="submit" class="add-button">BUSCAR</button>
                </form>
            </div>
            <table class="pedido-table">
                <thead>
                    <tr>
                        <th>SELECCIONAR</th>
                        <th>CANTIDAD</th>
                        <th>PRODUCTO</th>
                        <th>PRECIO</th>
                    </tr>
                </thead>
                <tbody>
                    {% if productos %}
                        {% for producto in productos %}
                        <tr>
                            <td><input type="checkbox" class="product-select" data-id="{{ producto.id_prod }}" data-nombre="{{ producto.nombre_prod }}" data-precio="{{ producto.precio_prod }}" data-stock="{{ producto.stock_actual_prod }}"></td>
                            <td>{{ producto.stock_actual_prod }}</td>
                            <td>{{ producto.nombre_prod }}</td>
                            <td>{{ producto.precio_prod }}</td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="4" style="text-align:center;">No hay productos disponibles</td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>

            <div class="product-edit-section">
                <h3>Editar Producto</h3>
                <form method="POST" action="{% url 'editar_producto' %}">
                    {% csrf_token %}
                    <input type="hidden" id="producto_id" name="producto_id">
                    <label for="nombre_prod">Producto:</label>
                    <input type="text" id="nombre_prod" name="nombre_prod" readonly><br>
                    <label for="precio_prod">Precio:</label>
                    <input type="number" id="precio_prod" name="precio_prod" step="0.01"><br>
                    <label for="stock_prod">Cantidad en Stock:</label>
                    <input type="number" id="stock_prod" name="stock_prod"><br>
                    <button type="submit" class="confirm-button">Guardar Cambios</button>
                </form>
            </div>
            <div class="actions">
                <a href="\registro_producto">
                    <button class="add-product-button">AGREGAR PRODUCTO</button>
                </a>
            </div>
            
        </div>
        <div class="text-left mb-4">
            <a href="{% url 'login:menu' %}" class="confirm-button">Volver al Men√∫</a>
        </div>
        

    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const checkboxes = document.querySelectorAll('.product-select');

            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', handleCheckboxChange);
                checkbox.addEventListener('click', loadProductData);
            });

            function handleCheckboxChange(event) {
                // Desmarcar todos los checkboxes antes de marcar el actual
                checkboxes.forEach(cb => {
                    if (cb !== event.target) {
                        cb.checked = false;
                    }
                });
            }

            function loadProductData(event) {
                const checkbox = event.target;
                const productId = checkbox.dataset.id;
                const productName = checkbox.dataset.nombre;
                const productPrice = checkbox.dataset.precio;
                const productStock = checkbox.dataset.stock;

                if (checkbox.checked) {
                    document.getElementById('producto_id').value = productId;
                    document.getElementById('nombre_prod').value = productName;
                    document.getElementById('precio_prod').value = productPrice;
                    document.getElementById('stock_prod').value = productStock;
                } else {
                    // Limpiar el formulario si se deselecciona
                    document.getElementById('producto_id').value = '';
                    document.getElementById('nombre_prod').value = '';
                    document.getElementById('precio_prod').value = '';
                    document.getElementById('stock_prod').value = '';
                }
            }
        });
    </script>
</body>
</html>